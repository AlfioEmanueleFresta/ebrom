(this.webpackJsonpebrom=this.webpackJsonpebrom||[]).push([[0],{82:function(e,t,n){},83:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var c,r=n(1),a=n.n(r),i=n(31),o=n.n(i),s=(n(82),n(11)),j=(n(83),n(28)),b=n.n(j),u=n(52),l=n(122),h=n(126),O=n(119),d=n(136),x=n(117),f=n(137),p=n(138),v=n(123),m=n(129),g=n(115),y=n(125),S=n(127),k=n(6),w=n(121),B=n(128),E=n(130),C=n(131),F=n(132),P=n(133),D=n(134),N=n(135),I=n(66),L=n.n(I),q=n(68),A=n(0),T="2f4ce2a3-fcbb-4f3a-b561-b9d78b5aae00",U="105c6761-74bf-4ffe-94ea-f8ba79f20600",M=[T,U],V=(c={},Object(k.a)(c,T,"Bike Info"),Object(k.a)(c,U,"Counters"),c);function G(e){var t=e.device,n=e.onDisconnect,c=Object(r.useState)(null),a=Object(s.a)(c,2),i=a[0],o=a[1],j=Object(r.useState)(null),b=Object(s.a)(j,2),u=b[0],O=b[1],d=new q.a;return Object(r.useEffect)((function(){i||d.acquire().then((function(e){t.gatt.getPrimaryServices().then((function(e){e=e.map((function(e){return{name:V[e.uuid],service:e}})),console.log("Found services",e),o(e)})).catch(O).finally((function(){return e()}))}))})),Object(A.jsxs)(l.a,{children:[Object(A.jsx)("header",{children:Object(A.jsx)("h2",{children:t.name})}),Object(A.jsx)(v.a,{onClick:function(){t.gatt.disconnect(),n()},children:"Disconnect"}),u&&Object(A.jsxs)(g.a,{severity:"error",children:[Object(A.jsx)(y.a,{children:"Service discovery failed"}),u.toString()]}),i?i.map((function(e){var t=e.name,n=e.service;return Object(A.jsx)(J,{name:t,service:n,gattMutex:d},n.uuid)})):Object(A.jsxs)(l.a,{children:[Object(A.jsx)(h.a,{variant:"subtitle1",component:"div",children:"Discovering services..."}),Object(A.jsx)(S.a,{})]})]})}function J(e){var t=e.gattMutex,n=e.name,c=e.service,a=Object(r.useState)(null),i=Object(s.a)(a,2),o=i[0],j=i[1],b=Object(r.useState)(null),u=Object(s.a)(b,2),l=u[0],O=u[1],d=Object(r.useState)(!1),x=Object(s.a)(d,2),f=x[0],p=x[1];return Object(r.useEffect)((function(){l||o||t.acquire().then((function(e){c.getCharacteristics().then(j).catch(O).finally((function(){return e()}))}))})),Object(A.jsx)(r.Fragment,{children:Object(A.jsxs)(w.a,{expanded:f,onChange:function(){return p(!f)},children:[Object(A.jsxs)(B.a,{expandIcon:Object(A.jsx)(L.a,{}),children:[Object(A.jsx)(h.a,{sx:{width:"33%",flexShrink:0},children:n}),Object(A.jsxs)(h.a,{sx:{color:"text.secondary"},children:[l&&Object(A.jsx)("span",{children:"Error"}),!l&&o?Object(A.jsx)("span",{children:o.length+" values"}):Object(A.jsx)(m.a,{})]})]}),Object(A.jsxs)(E.a,{children:[l&&Object(A.jsxs)(g.a,{severity:"error",children:[Object(A.jsx)(y.a,{children:"Service discovery failed"}),l.toString()]}),!l&&o?Object(A.jsxs)(C.a,{children:[Object(A.jsx)(F.a,{children:Object(A.jsxs)(P.a,{children:[Object(A.jsx)(D.a,{children:"Name"}),Object(A.jsx)(D.a,{align:"right",children:"Value"})]})}),Object(A.jsx)(N.a,{children:o.map((function(e){return Object(A.jsx)(W,{char:e,gattMutex:t},e.uuid)}))})]}):Object(A.jsx)(m.a,{})]})]},c.uuid)},c.uuid)}function Y(e){var t=new Uint8Array(e.buffer),n=(new TextDecoder).decode(t);return console.log("Parsed descriptor",e,n),n}function H(e){switch(e.byteLength){case 1:return e.getUint8();case 2:return e.getUint16();case 4:return e.getUint32();default:return new Uint8Array(e.buffer).toString()}}function W(e){var t=e.gattMutex,n=e.char,c=Object(r.useState)(null),a=Object(s.a)(c,2),i=a[0],o=a[1],j=Object(r.useState)(null),b=Object(s.a)(j,2),u=b[0],l=b[1],h=Object(r.useState)(null),O=Object(s.a)(h,2),d=O[0],x=O[1],f=Object(r.useState)(null),p=Object(s.a)(f,2),v=p[0],m=p[1];return Object(r.useEffect)((function(){v||i||(t.acquire().then((function(e){n.getDescriptor(10497).then(o).catch(m).finally((function(){return e()}))})),t.acquire().then((function(e){n.readValue().then(x).catch(m).finally((function(){return e()}))}))),v||!i||u||t.acquire().then((function(e){i.readValue().then(Y).then(l).catch(m).finally((function(){return e()}))}))})),Object(A.jsxs)(r.Fragment,{children:[v&&Object(A.jsx)(P.a,{children:Object(A.jsx)(D.a,{colSpan:2,children:Object(A.jsx)(g.a,{severity:"error",children:v.toString()})})},n.uuid+"error"),Object(A.jsxs)(P.a,{children:[Object(A.jsx)(D.a,{children:u?u.toString():"Loading..."},"name"),Object(A.jsx)(D.a,{align:"right",children:d?H(d):"..."},"value")]},n.uuid)]},n.uuid)}function _(){return(_=Object(u.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=navigator.bluetooth,!e.t0){e.next=5;break}return e.next=4,navigator.bluetooth.getAvailability();case 4:e.t0=e.sent;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){return K.apply(this,arguments)}function K(){return(K=Object(u.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.bluetooth.requestDevice({filters:[{name:"Brompton_Elec"}],optionalServices:M});case 2:return t=e.sent,window.device=t,console.log("Selected device",t),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){return(Q=Object(u.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.gatt.connect();case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){var t=e.onConnect,n=e.resume,c=void 0!==n&&n,a=Object(r.useState)(c?4:0),i=Object(s.a)(a,2),o=i[0],j=i[1],b=function(){return j(o-1)},u=function(){return j(o+1)},p=Object(r.useState)(null),v=Object(s.a)(p,2),m=v[0],g=v[1];return Object(A.jsxs)(l.a,{children:[Object(A.jsxs)(h.a,{variant:"h4",component:"div",children:["Let's get set up",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),Object(A.jsxs)(O.a,{activeStep:o,orientation:"vertical",children:[Object(A.jsxs)(d.a,{children:[Object(A.jsx)(x.a,{children:"Welcome"}),Object(A.jsx)(f.a,{children:Object(A.jsx)(Z,{onNext:u})})]},0),Object(A.jsxs)(d.a,{children:[Object(A.jsx)(x.a,{children:"Install the official Brompton Electric app"}),Object(A.jsx)(f.a,{children:Object(A.jsx)($,{onPrev:b,onNext:u})})]},1),Object(A.jsxs)(d.a,{children:[Object(A.jsx)(x.a,{children:"Pair your bike"}),Object(A.jsx)(f.a,{children:Object(A.jsx)(ee,{onPrev:b,onNext:u})})]},2),Object(A.jsxs)(d.a,{children:[Object(A.jsx)(x.a,{children:"Ensure your bike is switched on"}),Object(A.jsx)(f.a,{children:Object(A.jsx)(te,{onPrev:b,onNext:u})})]},3),Object(A.jsxs)(d.a,{children:[Object(A.jsx)(x.a,{children:"Find your bike"}),Object(A.jsx)(f.a,{children:Object(A.jsx)(ne,{onPrev:b,onSelectDevice:function(e){g(e),u()}})})]},4),Object(A.jsxs)(d.a,{children:[Object(A.jsx)(x.a,{children:"Connection attempt"}),Object(A.jsx)(f.a,{children:Object(A.jsx)(ce,{onPrev:b,onConnect:t,selectedDevice:m})})]},5)]})]})}function X(e){var t=e.back,n=e.cont;return Object(A.jsxs)(p.a,{children:[Object(A.jsx)(v.a,{disabled:!t,onClick:t,children:"Back"}),Object(A.jsx)(v.a,{onClick:n,children:"Continue"})]})}function Z(e){var t=e.onNext;return Object(A.jsxs)(r.Fragment,{children:[Object(A.jsxs)(h.a,{variant:"p",component:"p",children:["I've built this app to connect to my Brompton Electric, and access the information that is available via Bluetooth Low Energy (BLE), but isn't shown in the official app.",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),Object(A.jsx)(h.a,{variant:"p",component:"p",children:Object(A.jsxs)("strong",{children:["Note that I'm not affiliated in any way with Brompton and no warranty or support is offered with this app.",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]})}),Object(A.jsxs)(h.a,{variant:"p",component:"p",children:["If you encounter any issues, or if you have any feedback, please click the button below to raise an issue on the project's GitHub page. This is a free and open source project. If you're a software developer, note that all contributions are welcome!",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),Object(A.jsxs)(l.a,{children:[Object(A.jsx)(v.a,{href:"https://github.com/AlfioEmanueleFresta/ebrom/issues",children:"Feedback"}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),Object(A.jsx)(X,{back:null,cont:t})]})}function $(e){var t=e.onNext;return Object(A.jsxs)(r.Fragment,{children:[Object(A.jsxs)(h.a,{variant:"p",component:"p",children:["Brompton use a proprietary Bluetooth pairing mechanism, which means you can only pair your bike to your phone through their app.",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),Object(A.jsx)(h.a,{variant:"p",component:"p",children:"Once that's done, other apps on your phone will also be able to connect to your bike, using the standard Bluetooth Low Energy (BLE) interface."}),Object(A.jsx)(l.a,{m:2,children:Object(A.jsx)(v.a,{variant:"contained",href:"https://play.google.com/store/apps/details?id=com.brompton",children:"Download Brompton Electric app from the Google Play Store"})}),Object(A.jsx)(X,{back:null,cont:t})]})}function ee(e){var t=e.onPrev,n=e.onNext;return Object(A.jsxs)(r.Fragment,{children:[Object(A.jsxs)(h.a,{variant:"p",component:"p",children:["Use the Brompton Electric app to connect to your bike for the first time.",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),Object(A.jsxs)(h.a,{variant:"p",component:"p",children:["You only need to do this once. You can skip this step, if you've done it before.",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),Object(A.jsx)(X,{back:t,cont:n})]})}function te(e){var t=e.onPrev,n=e.onNext;return Object(A.jsxs)(r.Fragment,{children:[Object(A.jsxs)(h.a,{variant:"p",component:"p",children:["Turn on your bike.",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),Object(A.jsx)(X,{back:t,cont:n})]})}function ne(e){var t=e.onPrev,n=e.onSelectDevice,c=Object(r.useState)(!1),a=Object(s.a)(c,2),i=a[0],o=a[1],j=Object(r.useState)(!1),b=Object(s.a)(j,2),u=b[0],O=b[1],d=Object(r.useState)(null),x=Object(s.a)(d,2),f=x[0],p=x[1];return Object(r.useEffect)((function(){i||function(){return _.apply(this,arguments)}().then((function(e){O(e),o(!0)})).then((function(){z().then(n).catch(p)}))})),Object(A.jsxs)(r.Fragment,{children:[Object(A.jsxs)(h.a,{variant:"p",component:"p",children:["Click continue, and select your bike from the list of Bluetooth devices. There should only be one option, unless you're close to other bikes.",Object(A.jsx)("br",{}),Object(A.jsx)("br",{})]}),!i&&Object(A.jsxs)(l.a,{children:[Object(A.jsx)(m.a,{}),Object(A.jsx)(h.a,{variant:"subtitle1",component:"div",children:"Click the button below, and select your bike from the list of Bluetooth devices."})]}),i&&!u&&Object(A.jsxs)(g.a,{severity:"error",children:[Object(A.jsx)(y.a,{children:"Bluetooth not available"}),"Ensure your device is capable of connecting via Bluetooth (e.g. latest Chrome on Android)."]}),f&&Object(A.jsxs)(g.a,{severity:"error",children:[Object(A.jsx)(y.a,{children:"Failed to select device"}),f.toString()]}),Object(A.jsx)(X,{back:t,cont:u?function(){return z().then(n).catch(p)}:null})]})}function ce(e){var t=e.selectedDevice,n=e.onPrev,c=e.onConnect,a=Object(r.useState)(!0),i=Object(s.a)(a,2),o=i[0],j=i[1],b=Object(r.useState)(!1),u=Object(s.a)(b,2),O=u[0],d=u[1];return Object(r.useEffect)((function(){(function(e){return Q.apply(this,arguments)})(t).then(c).catch((function(){j(!1),d(!0)}))})),Object(A.jsxs)(r.Fragment,{children:[o&&Object(A.jsxs)(l.a,{children:[Object(A.jsx)(h.a,{variant:"h6",component:"div",children:"Connecting..."}),Object(A.jsx)(S.a,{})]}),O&&Object(A.jsxs)(g.a,{severity:"error",children:[Object(A.jsx)(y.a,{children:"An error has occurred"}),"Failed to connect to your Brompton. Ensure the bike is paired to the Brompton app."]}),Object(A.jsx)(X,{back:n,cont:null})]})}function re(){var e=Object(r.useState)(null),t=Object(s.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(!1),i=Object(s.a)(a,2),o=i[0],j=i[1];return Object(A.jsx)(l.a,{m:2,children:n?Object(A.jsx)(G,{device:n,onDisconnect:function(){c(!1),j(!0)}}):Object(A.jsx)(R,{onConnect:c,resume:o})})}var ae=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,139)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),a(e),i(e)}))};n(93),n(94),n(95),n(96);o.a.render(Object(A.jsx)(a.a.StrictMode,{children:Object(A.jsx)(re,{})}),document.getElementById("root")),ae()}},[[97,1,2]]]);
//# sourceMappingURL=main.b1bdddbd.chunk.js.map