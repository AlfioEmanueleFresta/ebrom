(this.webpackJsonpebrom=this.webpackJsonpebrom||[]).push([[0],{82:function(e,t,n){},83:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var c,r=n(1),a=n.n(r),i=n(31),o=n.n(i),s=(n(82),n(11)),j=(n(83),n(28)),u=n.n(j),b=n(52),l=n(122),h=n(126),O=n(119),d=n(136),x=n(117),f=n(137),p=n(138),v=n(123),m=n(129),g=n(115),y=n(125),S=n(127),k=n(6),w=n(121),C=n(128),B=n(130),E=n(131),F=n(132),P=n(133),D=n(134),L=n(135),N=n(66),q=n.n(N),I=n(68),M=n(0),U="2f4ce2a3-fcbb-4f3a-b561-b9d78b5aae00",A="105c6761-74bf-4ffe-94ea-f8ba79f20600",T=[U,A],V=(c={},Object(k.a)(c,U,"Bike Info"),Object(k.a)(c,A,"Counters"),c);function J(e){var t=e.device,n=e.onDisconnect,c=Object(r.useState)(null),a=Object(s.a)(c,2),i=a[0],o=a[1],j=Object(r.useState)(null),u=Object(s.a)(j,2),b=u[0],O=u[1],d=new I.a;return Object(r.useEffect)((function(){i||d.acquire().then((function(e){t.gatt.getPrimaryServices().then((function(e){e=e.map((function(e){return{name:V[e.uuid],service:e}})),console.log("Found services",e),o(e)})).catch(O).finally((function(){return e()}))}))})),Object(M.jsxs)(l.a,{children:[Object(M.jsx)("header",{children:Object(M.jsx)("h2",{children:t.name})}),Object(M.jsx)(v.a,{onClick:function(){t.gatt.disconnect(),n()},children:"Disconnect"}),b&&Object(M.jsxs)(g.a,{severity:"error",children:[Object(M.jsx)(y.a,{children:"Service discovery failed"}),b.toString()]}),i?i.map((function(e){var t=e.name,n=e.service;return Object(M.jsx)(Y,{name:t,service:n,gattMutex:d},n.uuid)})):Object(M.jsxs)(l.a,{children:[Object(M.jsx)(h.a,{variant:"subtitle1",component:"div",children:"Discovering services..."}),Object(M.jsx)(S.a,{})]})]})}function Y(e){var t=e.gattMutex,n=e.name,c=e.service,a=Object(r.useState)(null),i=Object(s.a)(a,2),o=i[0],j=i[1],u=Object(r.useState)(null),b=Object(s.a)(u,2),l=b[0],O=b[1],d=Object(r.useState)(!1),x=Object(s.a)(d,2),f=x[0],p=x[1];return Object(r.useEffect)((function(){l||o||t.acquire().then((function(e){c.getCharacteristics().then(j).catch(O).finally((function(){return e()}))}))})),Object(M.jsx)(r.Fragment,{children:Object(M.jsxs)(w.a,{expanded:f,onChange:function(){return p(!f)},children:[Object(M.jsxs)(C.a,{expandIcon:Object(M.jsx)(q.a,{}),children:[Object(M.jsx)(h.a,{sx:{width:"33%",flexShrink:0},children:n}),Object(M.jsxs)(h.a,{sx:{color:"text.secondary"},children:[l&&Object(M.jsx)("span",{children:"Error"}),!l&&o?Object(M.jsx)("span",{children:o.length+" values"}):Object(M.jsx)(m.a,{})]})]}),Object(M.jsxs)(B.a,{children:[l&&Object(M.jsxs)(g.a,{severity:"error",children:[Object(M.jsx)(y.a,{children:"Service discovery failed"}),l.toString()]}),!l&&o?Object(M.jsxs)(E.a,{children:[Object(M.jsx)(F.a,{children:Object(M.jsxs)(P.a,{children:[Object(M.jsx)(D.a,{children:"Name"}),Object(M.jsx)(D.a,{align:"right",children:"Value"})]})}),Object(M.jsx)(L.a,{children:o.map((function(e){return Object(M.jsx)(_,{char:e,gattMutex:t},e.uuid)}))})]}):Object(M.jsx)(m.a,{})]})]},c.uuid)},c.uuid)}function G(e){switch(e.byteLength){case 1:return e.getUint8();case 2:return e.getUint16();case 4:return e.getUint32();default:return new Uint8Array(e.buffer).toString()}}function _(e){var t=e.gattMutex,n=e.char,c=Object(r.useState)(null),a=Object(s.a)(c,2),i=a[0],o=a[1],j=Object(r.useState)(null),u=Object(s.a)(j,2),b=u[0],l=u[1],h=Object(r.useState)(null),O=Object(s.a)(h,2),d=O[0],x=O[1],f=Object(r.useState)(null),p=Object(s.a)(f,2),v=p[0],m=p[1];return Object(r.useEffect)((function(){v||i||(t.acquire().then((function(e){n.getDescriptor().then(o).catch(m).finally((function(){return e()}))})),t.acquire().then((function(e){n.readValue().then(x).catch(m).finally((function(){return e()}))}))),v||!i||b||t.acquire().then((function(e){i.readValue().then(l).catch(m).finally((function(){return e()}))}))})),Object(M.jsxs)(r.Fragment,{children:[v&&Object(M.jsx)(P.a,{children:Object(M.jsx)(D.a,{colSpan:2,children:Object(M.jsx)(g.a,{severity:"error",children:v.toString()})})},n.uuid+"error"),Object(M.jsxs)(P.a,{children:[Object(M.jsx)(D.a,{children:b?b.toString():"Loading..."},"name"),Object(M.jsx)(D.a,{align:"right",children:d?G(d):"..."},"value")]},n.uuid)]},n.uuid)}function z(){return(z=Object(b.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=navigator.bluetooth,!e.t0){e.next=5;break}return e.next=4,navigator.bluetooth.getAvailability();case 4:e.t0=e.sent;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return K.apply(this,arguments)}function K(){return(K=Object(b.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.bluetooth.requestDevice({filters:[{name:"Brompton_Elec"}],optionalServices:T});case 2:return t=e.sent,window.device=t,console.log("Selected device",t),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){return(Q=Object(b.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.gatt.connect();case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){var t=e.onConnect,n=e.resume,c=void 0!==n&&n,a=Object(r.useState)(c?2:0),i=Object(s.a)(a,2),o=i[0],j=i[1],u=function(){return j(o-1)},b=function(){return j(o+1)},p=Object(r.useState)(null),v=Object(s.a)(p,2),m=v[0],g=v[1];return Object(M.jsxs)(l.a,{children:[Object(M.jsxs)(h.a,{variant:"h4",component:"div",children:["Let's get set up",Object(M.jsx)("br",{}),Object(M.jsx)("br",{})]}),Object(M.jsxs)(O.a,{activeStep:o,orientation:"vertical",children:[Object(M.jsxs)(d.a,{children:[Object(M.jsx)(x.a,{children:"Install the official Bromtpon Electric app"}),Object(M.jsx)(f.a,{children:Object(M.jsx)(X,{onNext:b})})]},0),Object(M.jsxs)(d.a,{children:[Object(M.jsx)(x.a,{children:"Pair your bike"}),Object(M.jsx)(f.a,{children:Object(M.jsx)(Z,{onPrev:u,onNext:b})})]},1),Object(M.jsxs)(d.a,{children:[Object(M.jsx)(x.a,{children:"Ensure your bike is switched on"}),Object(M.jsx)(f.a,{children:Object(M.jsx)($,{onPrev:u,onNext:b})})]},2),Object(M.jsxs)(d.a,{children:[Object(M.jsx)(x.a,{children:"Find your bike"}),Object(M.jsx)(f.a,{children:Object(M.jsx)(ee,{onPrev:u,onSelectDevice:function(e){g(e),b()}})})]},3),Object(M.jsxs)(d.a,{children:[Object(M.jsx)(x.a,{children:"Connection attempt"}),Object(M.jsx)(f.a,{children:Object(M.jsx)(te,{onPrev:u,onConnect:t,selectedDevice:m})})]},4)]})]})}function W(e){var t=e.back,n=e.cont;return Object(M.jsxs)(p.a,{children:[Object(M.jsx)(v.a,{disabled:!t,onClick:t,children:"Back"}),Object(M.jsx)(v.a,{onClick:n,children:"Continue"})]})}function X(e){var t=e.onNext;return Object(M.jsxs)(r.Fragment,{children:[Object(M.jsxs)(h.a,{variant:"p",component:"p",children:["Brompton use a proprietary Bluetooth pairing mechanism, which means you can only pair your bike to your phone through their app.",Object(M.jsx)("br",{}),Object(M.jsx)("br",{})]}),Object(M.jsx)(h.a,{variant:"p",component:"p",children:"Once that's done, other apps on your phone will also be able to connect to your bike, using the standard Bluetooth Low Energy (BLE) interface."}),Object(M.jsx)(l.a,{m:2,children:Object(M.jsx)(v.a,{variant:"contained",href:"https://play.google.com/store/apps/details?id=com.brompton",children:"Download Brompton Electric app from the Google Play Store"})}),Object(M.jsx)(W,{back:null,cont:t})]})}function Z(e){var t=e.onPrev,n=e.onNext;return Object(M.jsxs)(r.Fragment,{children:[Object(M.jsxs)(h.a,{variant:"p",component:"p",children:["Use the Brompton Electric app to connect to your bike for the first time.",Object(M.jsx)("br",{}),Object(M.jsx)("br",{})]}),Object(M.jsxs)(h.a,{variant:"p",component:"p",children:["You only need to do this once. You can skip this step, if you've done it before.",Object(M.jsx)("br",{}),Object(M.jsx)("br",{})]}),Object(M.jsx)(W,{back:t,cont:n})]})}function $(e){var t=e.onPrev,n=e.onNext;return Object(M.jsxs)(r.Fragment,{children:[Object(M.jsxs)(h.a,{variant:"p",component:"p",children:["Turn on your bike.",Object(M.jsx)("br",{}),Object(M.jsx)("br",{})]}),Object(M.jsx)(W,{back:t,cont:n})]})}function ee(e){var t=e.onPrev,n=e.onSelectDevice,c=Object(r.useState)(!1),a=Object(s.a)(c,2),i=a[0],o=a[1],j=Object(r.useState)(!1),u=Object(s.a)(j,2),b=u[0],O=u[1],d=Object(r.useState)(null),x=Object(s.a)(d,2),f=x[0],p=x[1];return Object(r.useEffect)((function(){i||function(){return z.apply(this,arguments)}().then((function(e){O(e),o(!0)})).then((function(){H().then(n).catch(p)}))})),Object(M.jsxs)(r.Fragment,{children:[Object(M.jsxs)(h.a,{variant:"p",component:"p",children:["Click continue, and select your bike from the list of Bluetooth devices. There should only be one option, unless you're close to other bikes.",Object(M.jsx)("br",{}),Object(M.jsx)("br",{})]}),!i&&Object(M.jsxs)(l.a,{children:[Object(M.jsx)(m.a,{}),Object(M.jsx)(h.a,{variant:"subtitle1",component:"div",children:"Click the button below, and select your bike from the list of Bluetooth devices."})]}),i&&!b&&Object(M.jsxs)(g.a,{severity:"error",children:[Object(M.jsx)(y.a,{children:"Bluetooth not available"}),"Ensure your device is capable of connecting via Bluetooth (e.g. latest Chrome on Android)."]}),f&&Object(M.jsxs)(g.a,{severity:"error",children:[Object(M.jsx)(y.a,{children:"Failed to select device"}),f.toString()]}),Object(M.jsx)(W,{back:t,cont:b?function(){return H().then(n).catch(p)}:null})]})}function te(e){var t=e.selectedDevice,n=e.onPrev,c=e.onConnect,a=Object(r.useState)(!0),i=Object(s.a)(a,2),o=i[0],j=i[1],u=Object(r.useState)(!1),b=Object(s.a)(u,2),O=b[0],d=b[1];return Object(r.useEffect)((function(){(function(e){return Q.apply(this,arguments)})(t).then(c).catch((function(){j(!1),d(!0)}))})),Object(M.jsxs)(r.Fragment,{children:[o&&Object(M.jsxs)(l.a,{children:[Object(M.jsx)(h.a,{variant:"h6",component:"div",children:"Connecting..."}),Object(M.jsx)(S.a,{})]}),O&&Object(M.jsxs)(g.a,{severity:"error",children:[Object(M.jsx)(y.a,{children:"An error has occurred"}),"Failed to connect to your Brompton. Ensure the bike is paired to the Brompton app."]}),Object(M.jsx)(W,{back:n,cont:null})]})}function ne(){var e=Object(r.useState)(null),t=Object(s.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(!1),i=Object(s.a)(a,2),o=i[0],j=i[1];return Object(M.jsx)(l.a,{m:2,children:n?Object(M.jsx)(J,{device:n,onDisconnect:function(){c(!1),j(!0)}}):Object(M.jsx)(R,{onConnect:c,resume:o})})}var ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,139)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),a(e),i(e)}))};n(93),n(94),n(95),n(96);o.a.render(Object(M.jsx)(a.a.StrictMode,{children:Object(M.jsx)(ne,{})}),document.getElementById("root")),ce()}},[[97,1,2]]]);
//# sourceMappingURL=main.1fd18b88.chunk.js.map